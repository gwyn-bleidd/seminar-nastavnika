# Алгоритм решения задачи маршрутизации транспортных средств (CVRP)

Алгоритм решает задачу маршрутизации транспортных средств (CVRP) с использованием комбинации следующих методов:

## Инициализация решения

Используется либо метод ближайшего соседа (`nearest_neighbor_init`), либо метод Кларка-Райта (`clarke_wright_init`) для создания начального решения. Эти методы обеспечивают разумное начальное распределение маршрутов с учетом ограничений по вместимости транспортных средств.

## Детерминированный отжиг

Основной процесс оптимизации основан на методе отжига, где температура постепенно снижается. На каждой итерации алгоритм с определенной вероятностью принимает ухудшающие решения, что позволяет избежать застревания в локальных минимумах.

В процессе отжига применяется **стохастическая фаза**, где случайным образом выбираются операторы для изменения решения:

- **Swap**: Обмен узлами между маршрутами.
- **Relocate**: Перемещение узла из одного маршрута в другой.
- **Swap in Route**: Обмен узлами внутри одного маршрута.
- **Cross Exchange**: Обмен последовательностями узлов между маршрутами.

## Локальный поиск

На определенных этапах (например, при низкой температуре или через фиксированное количество итераций) применяется локальный поиск с использованием алгоритма Лин-Кернигана (`lin_kernighan`). Этот метод включает в себя:

- **2-opt**: Оптимизация маршрута путем перестановки двух ребер.
- **3-opt**: Оптимизация маршрута путем перестановки трех ребер.
- **Or-opt**: Оптимизация маршрута путем перемещения последовательности узлов.

## Валидация решения

После каждой итерации проверяется корректность решения с учетом ограничений по вместимости транспортных средств и посещения всех узлов.

## Сравнение с оптимальным решением

Алгоритм сравнивает найденное решение с известным оптимальным (если оно предоставлено) и вычисляет:
- Процент отклонения от оптимума.
- Процент улучшения по сравнению с начальным решением.


## Результаты для датасетов B, E, P
http://vrp.atd-lab.inf.puc-rio.br/index.php/en/



| Файл          | Оптимальная стоимость | Начальная стоимость | Лучшая стоимость | Отличие от оптимума | Улучшение | Валидность | Кол-во маршрутов | Время подсчёта |
|---------------|-----------------------|---------------------|------------------|---------------------|-----------|------------|------------------|----------------|
| B-n31-k5.vrp  | 672                   | 687.333             | 685.868          | 2.06%               | 0.22%     | True       | 5                | 1.93705        |
| B-n34-k5.vrp  | 788                   | 818.646             | 818.646          | 3.89%               | 0.00%     | True       | 5                | 3.57031        |
| B-n35-k5.vrp  | 955                   | 1000.16             | 990.46           | 3.71%               | 1.02%     | True       | 5                | 3.06459        |
| B-n38-k6.vrp  | 805                   | 860.098             | 846.523          | 5.16%               | 1.69%     | True       | 6                | 3.12845        |
| B-n39-k5.vrp  | 549                   | 602.79              | 577.046          | 5.11%               | 4.69%     | True       | 5                | 5.00145        |
| B-n41-k6.vrp  | 829                   | 911.909             | 908.072          | 9.54%               | 0.46%     | True       | 7                | 2.16984        |
| B-n43-k6.vrp  | 742                   | 844.187             | 822.354          | 10.83%              | 2.94%     | True       | 6                | 6.99126        |
| B-n44-k7.vrp  | 909                   | 950.489             | 949.954          | 4.51%               | 0.06%     | True       | 7                | 2.90018        |
| B-n45-k5.vrp  | 751                   | 790.399             | 764.622          | 1.81%               | 3.43%     | True       | 6                | 7.60088        |
| B-n45-k6.vrp  | 678                   | 759.586             | 759.586          | 12.03%              | 0.00%     | True       | 7                | 4.94584        |
| B-n50-k7.vrp  | 741                   | 782.564             | 758.407          | 2.35%               | 3.26%     | True       | 7                | 11.3112        |
| B-n50-k8.vrp  | 1312                  | 1391.49             | 1376.63          | 4.93%               | 1.13%     | True       | 8                | 3.30018        |
| B-n51-k7.vrp  | 1032                  | 1075.09             | 1034.37          | 0.23%               | 3.95%     | True       | 8                | 3.25055        |
| B-n52-k7.vrp  | 747                   | 797.553             | 788.427          | 5.55%               | 1.22%     | True       | 7                | 10.1229        |
| B-n56-k7.vrp  | 707                   | 764.037             | 739.493          | 4.60%               | 3.47%     | True       | 7                | 8.8257         |
| B-n57-k7.vrp  | 1153                  | 1248.79             | 1246             | 8.07%               | 0.24%     | True       | 8                | 6.71129        |
| B-n57-k9.vrp  | 1598                  | 1672.81             | 1657.08          | 3.70%               | 0.98%     | True       | 9                | 4.8777         |
| B-n63-k10.vrp | 1496                  | 1604.57             | 1604.57          | 7.26%               | 0.00%     | True       | 10               | 4.1641         |
| B-n64-k9.vrp  | 861                   | 955.231             | 932.928          | 8.35%               | 2.59%     | True       | 10               | 6.41481        |
| B-n66-k9.vrp  | 1316                  | 1492.42             | 1429.49          | 8.62%               | 4.78%     | True       | 10               | 5.88428        |
| B-n67-k10.vrp | 1032                  | 1143.57             | 1117.25          | 8.26%               | 2.55%     | True       | 10               | 6.45251        |
| B-n68-k9.vrp  | 1272                  | 1339.49             | 1339.49          | 5.31%               | 0.00%     | True       | 9                | 8.84356        |
| B-n78-k10.vrp | 1221                  | 1332.31             | 1274.26          | 4.36%               | 4.75%     | True       | 10               | 12.8749        |

**Итого отличие от оптимума: 5.66%**



| Файл           | Оптимальная стоимость | Начальная стоимость | Лучшая стоимость | Отличие от оптимума | Улучшение | Валидность | Кол-во маршрутов | Время подсчёта |
|----------------|-----------------------|---------------------|------------------|---------------------|-----------|------------|------------------|----------------|
| E-n101-k14.vrp | 1067                  | 1356.56             | 1189.39          | 11.47%              | 15.67%    | True       | 14               | 12.4381        |
| E-n101-k8.vrp  | 815                   | 1257.43             | 926.917          | 13.73%              | 40.55%    | True       | 8                | 77.4755        |
| E-n22-k4.vrp   | 375                   | 419.048             | 419.048          | 11.75%              | 0.00%     | True       | 4                | 0.838349       |
| E-n23-k3.vrp   | 569                   | 800.156             | 569.746          | 0.13%               | 40.49%    | True       | 3                | 9.75704        |
| E-n30-k3.vrp   | 534                   | 668.946             | 509.161          | -4.65%              | 29.92%    | True       | 4                | 9.54108        |
| E-n33-k4.vrp   | 835                   | 970.109             | 909.434          | 8.91%               | 7.27%     | True       | 4                | 13.4895        |
| E-n51-k5.vrp   | 521                   | 669.031             | 625.793          | 20.11%              | 8.30%     | True       | 5                | 18.9312        |
| E-n76-k10.vrp  | 830                   | 1051.5              | 941.751          | 13.46%              | 13.22%    | True       | 10               | 9.32487        |
| E-n76-k14.vrp  | 1021                  | 1133.43             | 1081.22          | 5.90%               | 5.11%     | True       | 15               | 2.26956        |
| E-n76-k7.vrp   | 682                   | 929.366             | 828.629          | 21.50%              | 14.77%    | True       | 7                | 44.0548        |
| E-n76-k8.vrp   | 735                   | 1035.82             | 861.183          | 17.17%              | 23.76%    | True       | 8                | 21.7399        |

**Итого отличие от оптимума: 10.86%**



| Файл          | Оптимальная стоимость | Начальная стоимость | Лучшая стоимость | Отличие от оптимума | Улучшение | Валидность | Кол-во маршрутов | Время подсчёта |
|---------------|-----------------------|---------------------|------------------|---------------------|-----------|------------|------------------|----------------|
| P-n101-k4.vrp | 681                   | 1483.93             | 861.435          | 26.50%              | 91.41%    | True       | 4                | 731.572        |
| P-n16-k8.vrp  | 450                   | 478.771             | 478.771          | 6.39%               | 0.00%     | True       | 9                | 0.0360253      |
| P-n19-k2.vrp  | 212                   | 301.792             | 243.137          | 14.69%              | 27.67%    | True       | 2                | 5.55568        |
| P-n20-k2.vrp  | 216                   | 306.618             | 248.59           | 15.09%              | 26.86%    | True       | 2                | 5.26964        |
| P-n21-k2.vrp  | 211                   | 313.845             | 275.374          | 30.51%              | 18.23%    | True       | 2                | 9.82084        |
| P-n22-k2.vrp  | 216                   | 317.158             | 252.299          | 16.81%              | 30.03%    | True       | 2                | 9.19702        |
| P-n22-k8.vrp  | 603                   | 590.621             | 590.621          | -2.05%              | 0.00%     | True       | 9                | 0.0731988      |
| P-n23-k8.vrp  | 529                   | 539.475             | 539.475          | 1.98%               | 0.00%     | True       | 9                | 0.0545433      |
| P-n40-k5.vrp  | 458                   | 622.771             | 554.522          | 21.07%              | 14.90%    | True       | 5                | 6.59723        |
| P-n45-k5.vrp  | 510                   | 621.712             | 582.521          | 14.22%              | 7.68%     | True       | 5                | 11.5445        |
| P-n50-k10.vrp | 696                   | 766.6               | 766.6            | 10.14%              | 0.00%     | True       | 11               | 1.0991         |
| P-n50-k7.vrp  | 554                   | 686.718             | 634.874          | 14.60%              | 9.36%     | True       | 7                | 6.14064        |
| P-n50-k8.vrp  | 631                   | 671.88              | 650.38           | 3.07%               | 3.41%     | True       | 9                | 2.91146        |
| P-n51-k10.vrp | 741                   | 783.204             | 783.204          | 5.70%               | 0.00%     | True       | 11               | 1.07309        |
| P-n55-k10.vrp | 694                   | 817.783             | 758.55           | 9.30%               | 8.53%     | True       | 10               | 3.95494        |
| P-n55-k15.vrp | 989                   | 995.939             | 985.147          | -0.39%              | 1.09%     | True       | 17               | 0.495643       |
| P-n55-k7.vrp  | 568                   | 730.831             | 642.435          | 13.10%              | 15.56%    | True       | 7                | 11.386         |
| P-n55-k8.vrp  | 588                   | 711.257             | 629.903          | 7.13%               | 13.84%    | True       | 7                | 7.22265        |
| P-n60-k10.vrp | 744                   | 875.686             | 808.617          | 8.69%               | 9.01%     | True       | 10               | 2.95667        |
| P-n60-k15.vrp | 968                   | 1022.75             | 1021.94          | 5.57%               | 0.08%     | True       | 16               | 0.661829       |
| P-n65-k10.vrp | 792                   | 960.836             | 911.17           | 15.05%              | 6.27%     | True       | 10               | 4.33174        |
| P-n70-k10.vrp | 827                   | 966.554             | 903.777          | 9.28%               | 7.59%     | True       | 11               | 4.91585        |
| P-n76-k4.vrp  | 593                   | 1030.51             | 703.81           | 18.69%              | 55.09%    | True       | 4                | 219.078        |
| P-n76-k5.vrp  | 627                   | 941.508             | 710.79           | 13.36%              | 36.80%    | True       | 5                | 103.321        |

**Итого отличие от оптимума: 11.60%**

